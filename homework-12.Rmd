---
title: "Homework Problem Set 12: Composite Hypothesis, Confidence Intervals for Statistical Tests, and the Sign Test"
output: 
  html_document: 
    theme: readable
header-includes:
  - \usepackage{array}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", 
  cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(tidyverse)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](homework-12.pdf) copy of this homework assignment.", sep = ""), "")`

**Instructions**: These homework problems concern composite null hypotheses, the use of confidence intervals for statistical tests, and the sign tests. The solutions for the composite null hypothesis and confidence interval problems problems are given at the end.[^rounding] For the sign test problems the answer is given and you are asked to confirm the answer by computing it yourself. 

[^rounding]: In the solutions the reported values of test statistics and p-values have been rounded to the second and third decimal place, respectively. Rounding was only done for the final reported values. It was avoided in intermediate calculations (e.g., the value of the test statistic used to compute a p-value was *not* rounded).

```{r}
n.lice <- 100
x.lice <- 20
z.lice <- (x.lice/n.lice - 0.15)/sqrt(0.15 * (1 - 0.15) / n.lice)
p.lice <- round(pnorm(-z.lice), 3)
```

## Incidence of Foot Lice

Researchers at the National Institutes of Hobbit Health (NIHH) were interested in determining if there had be an increase in the incidence of foot lice in the West Farthing. A year ago a very large survey had estimated that 15\% of Hobbits in the West Farthing had foot lice. This year resources were not available for such a large survey, so the researchers obtained a random sample of only `r n.lice` Hobbits from the West Farthing and tested them for foot lice. Of those Hobbits `r x.lice` tested positive for foot lice. Let $p$ be the probability of sampling a Hobbit with foot lice this year. Then $p$ is also the proportion of Hobbits *in the population* that have foot lice this year. The question then is whether this proportion has increased since last year (i.e., $p > 0.15$) or not (i.e., $p \le 0.15$). Conduct a statistical test with the composite null hypothesis $H_0: p \le 0.15$ versus the composite alternative hypothesis $H_a: p > 0.15$ using a significance level of 0.05.

## Vegemite Quality Control

```{r}
m1.veg <- 235
s1.veg <- 10
n1.veg <- 25
m2.veg <- 207
s2.veg <- 15
n2.veg <- 25
```

A quality control analyst is responsible for maintaining the quality of Vegemite produced and packaged at a production facility. The facility produces many thousands of bottles per run. To monitor the production process the analyst using simple random sampling to select a few bottles from each run and tests them. One thing she monitors is if the bottles are over-filled or under-filled, on average. These bottles should contain about 220g of Vegemite. Each bottle will contain an amount that deviates from that by some amount which is tolerable if the deviation is not too large. But problems can arise if the bottles are contain too much or too little Vegemite, on average. In what follows let $\mu$ denote the mean amount of Vegemite per bottle in a run. The analyst tries to determine if $\mu$ becomes higher than 230g or lower than 210g. 

1. During one production run a random sample of `r n1.veg` bottles was selected. The mean contents per bottle in this sample was `r m1.veg` grams, and the standard deviation was `r s1.veg` grams. Conduct a test with the composite null hypothesis $\mu \le 230$ versus the composite alternative hypothesis $\mu > 230$. Use a significance level of 0.05. 

2. During another production run a random sample of `r n2.veg` bottles was selected. The mean contents per bottle in this sample was `r m2.veg` grams, and the standard deviation was `r s2.veg` grams. Conduct a test with the composite null hypothesis $\mu \ge 210$ versus the composite alternative hypothesis $\mu < 210$. Use a significance level of 0.05. 

## Confidence Intervals for Statistical Tests

```{r}
m.ci <- 105 
s.ci <- 10
n.ci <- 25
t.95 <- round(-qt(0.05/2, df = n.ci - 1), 3)
t.99 <- round(-qt(0.01/2, df = n.ci - 1), 3)
m0 <- seq(98, 112, by = 2)
```

Suppose I computed *two* confidence intervals for $\mu$ based on a sample of observations. The first confidence interval,
$$ 
`r m.ci` \pm `r t.95*s.ci/sqrt(n.ci)` \Leftrightarrow (`r m.ci - t.95*s.ci/sqrt(n.ci)`, `r m.ci + t.95*s.ci/sqrt(n.ci)`),
$$
is based on a confidence level of 95\%. The second confidence interval,
$$ 
`r m.ci` \pm `r t.99*s.ci/sqrt(n.ci)` \Leftrightarrow (`r m.ci - t.99*s.ci/sqrt(n.ci)`, `r m.ci + t.99*s.ci/sqrt(n.ci)`),
$$
is based on a confidence level of 99\%. 

Now consider statistical test with the hypotheses $H_0\!: \mu = \mu_0$ versus $H_a\!: \mu \neq \mu_0$. Consider the following possible values of $\mu_0$: `r m0`. Recall that we can using a confidence interval to conduct the statistical test in the sense that the confidence interval will determine if the null hypothesis is rejected or not. 

1. Of the eight null hypotheses, which would be *rejected* when using a significance level of $\alpha$ = 0.05? 

0. Of the eight null hypotheses, which would be *rejected* when using a significance level of $\alpha$ = 0.01?

\pagebreak

## Sign Test Table

The table below is used for the remaining problems involving the sign test. The table gives the sampling distribution of the number of positive signs out of a total number of signs, where it is assumed that the probability of a positive sign is 0.5 under the null hypothesis.[^signrounding] Use this table to compute $p$-values for sign tests in the next three problems.

[^signrounding]: These numbers have been rounded to four decimal places.

\footnotesize

```{r}
n <- 7:16
x <- 0:max(n)
p <- matrix("", max(n) + 1, length(n))
for (i in 1:length(n)) {
  p[1:(n[i]+1), i] <- as.character(format(round(dbinom(0:n[i], n[i], 0.5), 4), nsmall = 4)) 
}
d <- as.data.frame(cbind(x, p))
names(d) <- c("$+$ Signs", n)
ktbl(d) %>% add_header_above(c(" " = 1, "Total Number of Signs" = length(n)))
```

\normalsize

## Vegemite and Marmite for Foot Hair Softening 

```{r}
set.seed(101)
p <- 5
xv <- rbinom(10, 4, 0.6) + 1
xm <- rbinom(10, 4, 0.4) + 1
t <- sum(sign(xv - xm) == 1)
n <- sum(xv != xm)
i <- 1
```

Marketing researchers were interested in consumer opinion of the effectiveness of Vegemite and Marmite at promoting foot hair softness. They conducted a study using a matched-pairs design with `r length(xv)` subjects where for one week Vegemite would be applied to the foot hair of one foot (selected at random) while Marmite would be applied to the other foot. After one week each subject was asked to rate the softness of the hair on each foot on a `r p`-point scale with higher numbers indicating greater softness. The results are given in the table below.
```{r}
d <- data.frame(
  Subject = c("Hildegard Took-Brandybuck", "Engelberge Littlefoot", 
    "Laura Bottomhill","Gundradis Hairyfoot","Myrna Proudmead",
    "Ponto Mugwort","Theodulph Underhill","Holfast Whitbottom",
    "Faramond Underburrow","Odo Heathertoes"),
  Vegemite = xv, Marmite = xm) %>% mutate(Difference = Vegemite - Marmite) %>% 
  mutate(Sign = case_when(Difference > 0 ~ "$+$", Difference < 0 ~ "$-$", Difference == 0 ~ " "))
ktbl(d, align = "lcccc") %>% add_header_above(c(" " = 1, "Product" = 2, " " = 1, " " = 1))
```
Consider a *sign test* applied to the signs of the differences of the ratings between the Vegemite foot and the Marmite foot (i.e., Vegemite foot rating minus Marmite foot rating). Let $n$ denote the number of signs and let $p$ denote the probability of a positive sign. Confirm that the p-value for a *sign test* with the hypotheses $H_0\!: p = 0.5$ versus $H_a\!: p > 0.5$ is approximately `r sum(round(dbinom(t:n, n, 0.5), 4))`. Also confirm that the p-value for when the alternative hypothesis is $H_a\!: p \neq 0.5$ is approximately `r 2*sum(round(dbinom(t:n, n, 0.5), 4))`.

## Darwin's Corn Seedling Study Revisited

```{r}
d <- HistData::ZeaMays
yc <- with(d, format(cross, nsmall = 3))
ys <- with(d, format(self, nsmall = 3))
i <- 1
```

Recall Charles Darwin's study that compared the heights of corn seedlings produced from cross-fertilization with those produced from self-fertilization.[^darwin] He used a *matched-pairs* design. Seedlings were raised in pairs where in each pair there was one seedling produced by each type of fertilization. The data are given in the table below.
```{r}
d <- data.frame(Pair = 1:15, Cross = yc, Self = ys)
ktbl(d) %>% add_header_above(c(" " = 1, "Fertilization" = 2))
```
Darwin's motivation for this study was to show that cross-fertilization tends to result in plants that are more fit than self-fertilization. If this is true then it would be expected that the seedlings produced by cross-fertilization would tend to be taller than those produced by self-fertilization. Verify that the p-value for a one-sided *sign test* applied to these data is approximately `r sum(round(dbinom(13:15, 15, 0.5), 4))`. (Hint: You do not need to actually compute differences. The *signs* of the differences should be obvious.)

[^darwin]: Darwin, C. (1876). *The effect of cross- and self-fertilization in the vegetable kingdom* (2nd ed). London: John Murray.

## Generalized Reciprocity in Rats Revisited

In an earlier homework assignment you encountered a study that examined if there was evidence of *generalized reciprocity* in rats.[^reciprocity] Reciprocity is when an organism helps another organism in return for that organism helping them. *Generalized* reciprocity is when the organism that was helped helps another organism, but not the organism from which they received help. Rats were trained to learn that they could pull a lever that would "help" another rat by providing a small bit of food. The study then used a cross-over design to observe the number of pulls per minute made by each rat under each of two treatment conditions: one where the rat had recently received help from another rat (by providing it food), and another where the rat had not recently received such help. The order of the treatments was randomized and the observations made under the two treatment conditions were separated in time. The figure below shows the difference in the number of pulls per minute (pulls per minute in the help condition minus the pulls per minute in the no help condition).
```{r, fig.height = 3}
d <- trtools::reciprocity
d$rat <- as.numeric(as.factor(d$rat))

p <- ggplot(d, aes(x = factor(rat), y = help - nohelp))
p <- p + geom_point(shape = 21, fill = "black", size = 0.75) + theme_minimal() + coord_flip()
p <- p + labs(x = "Rat", y = "Difference")
p <- p + theme(axis.text = element_text(size = 5))
plot(p)
```
There is what appears to be a tendency for rats to pull the level more frequently after they have been helped, but it is not (yet) clear if this is a statistically significant result. In an earlier homework you used that $t$-test (i.e., a test based on the $t$ test statistic) to answer this question. Here you will use the *sign test* as an alternative approach. Confirm that the $p$-value for this test is approximately `r sum(round(dbinom(13:16, 16, 0.5), 4))`. (Hint: The signs of the differences can be seen from the figure on the right. Recall that a difference of zero does not have a sign.)

[^reciprocity]: Rutte, C. & Taborsky, M. (2007). Generalized reciprocity in rats. *PLoS Biol*, *5(7)*: e196. doi:10.1371/journal.pbio.0050196.

\pagebreak

## Incidence of Foot Lice (Solutions)

Our hypotheses would be $H_0\!: p \le 0.15$ and $H_a\!: p > 0.15$. If we assume $p = 0.15$ then the test statistic is $z \approx `r round(z.lice, 2)`$. This test statistic would yield a p-value of about `r p.lice`. Using a significance level of $\alpha = 0.05$ our decision would therefore be to *not reject* $H_0$ and conclude that there is not evidence of an increase in the incidence of foot lice.

## Vegemite Quality Control (Solutions)

```{r}
t.1 <- (m1.veg - 230)/(s1.veg/sqrt(n1.veg))
p.1 <- pt(-abs(t.1), df = n1.veg)
t.2 <- (m2.veg - 210)/(s2.veg/sqrt(n2.veg))
p.2 <- pt(-abs(t.2), df = n2.veg)
```

1. If we assume $\mu = 230$ as our null hypothesis then the test statistic is $t = `r t.1`$. This value of the test statistic would yield a p-value of about `r round(p.1, 3)`. Thus we reject $\mu = 230$ and must also reject the composite null hypothesis $H_0: \mu \le 230$. 

2. If we assume $\mu = 210$ as our null hypothesis then the test statistic is $t = `r t.2`$. This value of the test statistic would yield a p-value of about `r round(p.2, 3)`. Thus we do not reject $\mu = 210$ and cannot therefore reject the composite null hypothesis $H_0: \mu \ge 210$.

## Confidence Intervals for Statistical Tests (Solutions)

1. For $\alpha$ = 0.05 we would reject the null hypothesis $H_0\!:\mu = \mu_0$ for values of $\mu_0$ of 98, 100, 110, and 112.

0. For $\alpha$ = 0.01 we would reject the null hypothesis for values of $\mu_0$ of 98 and 112. 






```{r}
rm(list = ls())
```

