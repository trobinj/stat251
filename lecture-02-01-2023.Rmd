---
output:
  html_document: 
    theme: readable
  pdf_document: default
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "02-01-2023"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
output:
  html_document: 
    theme: readable
  pdf_document: default
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{array}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(tidyverse)
suppressWarnings(library(kableExtra))
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`


## Computing Probabilities (Discrete Random Variables)

Often probabilities concerning a *discrete* random variables can be computed from its probability distribution using *summation*.

**Example**: Consider the probability distribution of the mean distance (i.e., $\bar{x}$) from a sample of $n$ = 3 throws of the trebuchet (a *sampling distribution*).
```{r}
x <- 1:3
p <- c(0.1,0.3,0.6)
d <- expand.grid(x1 = x, x2 = x, x3 = x)
d$xbar <- apply(d, 1, mean)
d$prob <- apply(expand.grid(p1 = p, p2 = p, p3 = p), 1, prod)
d <- d %>% group_by(xbar) %>% summarize(prob = sum(prob))
d$label <- format(d$prob, nsmall = 3)
smpdist <- data.frame(Distance = round(d$xbar, 2), Probability = d$label)
names(smpdist) <- c("$\\bar{x}$", "$P(\\bar{x})$")
ktbl(smpdist)
```

What are the probabilities of the following events?

1. The mean distance is less than 1.67 meters.

\vspace{2cm}

2. The mean distance is greater than 2.33 meters.

\vspace{2cm}

3. The mean distance is greater than 1.5 and less than 2.5 meters.

\vspace{2cm}

Note that we simply sum the probabilities of the values of the variable for which the event is true.

\pagebreak

**Example**: The figure below shows the sampling distribution of $\bar{x}$ based on a sample of $n$ = 10 observations of the throwing distance of the trebuchet.
```{r, fig.height = 5, fig.width = 9}
x <- 1:3
p <- c(0.1,0.3,0.6)

n <- 10

xvec <- vector("list", length = n)
pvec <- vector("list", length = n)

for (i in 1:n) {
  xvec[[i]] <- x
  pvec[[i]] <- p
}

d <- data.frame(xbar = apply(expand.grid(xvec), 1, mean), prob = apply(expand.grid(pvec), 1, prod)) %>%
  group_by(xbar) %>% summarize(prob = sum(prob)) %>% mutate(grp = xbar > 1.5 & xbar < 2.5)

p <- ggplot(d, aes(x = xbar, y = prob, color = grp)) + theme_classic()
p <- p + geom_segment(aes(xend = xbar, yend = 0)) + geom_point()
p <- p + scale_x_continuous(breaks = unique(d$xbar)) + guides(color = "none")
p <- p + geom_text(aes(y = prob + 0.01, label = format(round(prob, 3), scientific = FALSE)), size = 3)
p <- p + labs(x = tex("$\\bar{x}$"), y = tex("$P(\\bar{x})$"))
plot(p)
```
What is the probability that $\bar{x}$ is greater than 1.5 and less than 2.5 meters?

\pagebreak

## Continuous Random Variables

Continuous random variables require a different mathematical treatment. Note that we cannot simply list the possible values of a continuous random variable and their probabilities. 

## Probability Density

The probability distribution of a *continuous* random variable is typically represented by a *function*, which we will usually consider *graphically*. This function relates the *value* of the random variable to its *probability density*. 

**Example**: Consider the following hypothetical probability distributions of reaction time.
```{r, fig.height = 3, fig.width = 9}
d <- data.frame(x = seq(0, 1, length = 1000))
d$y <- with(d, dbeta(x, 2, 5))
d$x <- d$x * 2
d$y <- d$y / 2

p <- ggplot(d, aes(x = x, y = y))
p <- p + geom_line()
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25) + ggtitle("Fast")
plot(p)

d <- data.frame(x = seq(0, 1, length = 1000))
d$y <- with(d, dbeta(x, 3, 3))
d$x <- d$x * 2
d$y <- d$y / 2

p <- ggplot(d, aes(x = x, y = y))
p <- p + geom_line()
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25) + ggtitle("Medium")
plot(p)

d <- data.frame(x = seq(0, 1, length = 1000))
d$y <- with(d, dbeta(x, 5, 2))
d$x <- d$x * 2
d$y <- d$y / 2

p <- ggplot(d, aes(x = x, y = y))
p <- p + geom_line()
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25) + ggtitle("Slow")
plot(p)
```

The distribution is represented by a function $f(x)$ which gives the *probability density* of $x$. It has three properties:

1. Probability density is non-negative so that $f(x) \ge 0$.

0. The area under $f(x)$ and above zero always equals one.

0. The area under $f(x)$ and between $a$ and $b$ equals $P(a < x < b)$. 

**Example**: What is the probability that reaction time is between 0.5 and 1.0 seconds --- i.e., $P(0.5 < X < 1)$?

```{r, fig.height = 3, fig.width = 9}
f <- function(x,a,b) {
  dbeta(x/2, a, b)/2
}
p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5), geom = "area", xlim = c(0.5, 1.0), alpha = 0.25, n = 1000)
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "x", y = "f(x)")
p <- p + theme_classic() + ylim(0, 1.25)
plot(p)
```

**Example**: What is the probability that reaction time is less than 0.5 seconds --- i.e., $P(X < 0.5)$? 

```{r, fig.height = 3, fig.width = 9}
f <- function(x,a,b) {
  dbeta(x/2, a, b)/2
}
p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5), geom = "area", xlim = c(0, 0.5), alpha = 0.25, n = 1000)
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "x", y = "f(x)")
p <- p + theme_classic() + ylim(0, 1.25)
plot(p)
```

**Example**: What is the probability that reaction time is greater than 1.0 seconds --- i.e., $P(X > 1)$? 

```{r, fig.height = 3, fig.width = 9}
f <- function(x,a,b) {
  dbeta(x/2, a, b)/2
}
p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5), geom = "area", xlim = c(1, 2), alpha = 0.25, n = 1000)
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "x", y = "f(x)")
p <- p + theme_classic() + ylim(0, 1.25)
plot(p)
```

**Example**: What is the probability that reaction time *equals* 1.0 seconds --- i.e., $P(X = 1)$? 

```{r, fig.height = 3, fig.width = 9}
f <- function(x,a,b) {
  dbeta(x/2, a, b)/2
}
p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + geom_segment(aes(x = 1, xend = 1, y = 0, yend = f(1, 2, 5)), alpha = 0.25)
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "x", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25)
plot(p)
```

\pagebreak

**Example**: Suppose reaction time had the following probability distribution.

```{r, fig.height = 3, fig.width = 9}
d <- data.frame(x = c(0,0,0.25,0.25,0.5,0.5,0.5,1,1,1.25,1.25,2,2), y = c(0,4,4,5,5,4,3,3,2,2,1,1,0)/5)
p <- ggplot(d, aes(x = x, y = y))
p <- p + theme_classic()
p <- p + theme(panel.grid.major = element_line(color = grey(0.5), linetype = 2))
p <- p + geom_line()
p <- p + scale_x_continuous(breaks = seq(0, 6, by = 0.5))
p <- p + labs(x = "x", y = "Probability Density")
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.25), limits = c(0,2))
p <- p + scale_y_continuous(breaks = seq(0, 1, by = 0.2))
plot(p)
```

The following probabilities are relatively easy to confirm.

1. $P(X < 0.5) = `r 9*0.05`$.

2. $P(X > 0.5) = `r 1 - 9*0.05`$.

3. $P(0.25 < X < 0.5) = `r 5*0.05`$.

4. $P(0.5 < X < 1.0) = `r 6*0.05`$.

5. $P(X < 1) = `r 1 - 5*0.05`$ (which shows that $Q_3 = 1$).

\pagebreak

**Example**: Consider the following probability distribution of a continuous random variable $x$.
```{r, fig.height = 3, fig.width = 9}
d <- data.frame(x = c(0,0,1,1,2,2,3,3,5,5,11,11), y = c(0,0.1,0.1,0.15,0.15,0.25,0.25,0.1,0.1,0.05,0.05,0))

p <- ggplot(d, aes(x = x, y = y))
p <- p + theme_classic()
p <- p + theme(panel.grid.major = element_line(color = grey(0.5), linetype = 2))
p <- p + geom_line()
p <- p + scale_x_continuous(breaks = 0:11)
p <- p + labs(x = "x", y = "Probability Density")
plot(p)
```
The three *quartiles* have the property that
\begin{align}
P(X < Q_1) & = 0.25, \\ 
P(X < Q_2) & = 0.5, \\
P(X < Q_3) & = 0.75.
\end{align}
What are the quartiles? Hint: They are whole numbers for this distribution.

## Mean and Variance of a Continuous Random Variable

1. The mean ($\mu$) of continuous random variable cannot (usually) be defined or computed without calculus, but it is the "balance point" of its probability distribution.

2. The standard deviation ($\sigma$) of a continuous random variable cannot (usually) be defined or computed without calculus, but it measures the "spread" of the probability distribution.
\pagebreak

## Approximating Areas/Probabilities

**Example**: Consider computing the probability $P(0.2 < X < 0.7)$.

```{r, fig.height = 3, fig.width = 9}
f <- function(x,a,b) {
  dbeta(x/2, a, b)/2
}

e <- 3
d <- data.frame(x = seq(0.5 + 0.5/e/2 - 0.3, 1.0 - 0.5/e/2 - 0.3, length = e))
d$y <- f(d$x, 2, 5)

prb.est <- sum(d$y * 0.5/e)

p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25)
p <- p + geom_col(aes(y = y), data = d, fill = grey(0.75), alpha = 0.75, color = "black", width = 0.5/e)
p <- p + annotate("text", x = 1.5, y = 1.1, label = paste("Area:", round(prb.est, 4)), size = 4)
plot(p)

e <- 5
d <- data.frame(x = seq(0.5 + 0.5/e/2 - 0.3, 1.0 - 0.5/e/2 - 0.3, length = e))
d$y <- f(d$x, 2, 5)

prb.est <- sum(d$y * 0.5/e)

p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25)
p <- p + geom_col(aes(y = y), data = d, fill = grey(0.75), alpha = 0.75, color = "black", width = 0.5/e)
p <- p + annotate("text", x = 1.5, y = 1.1, label = paste("Area:", round(prb.est, 4)), size = 4)
plot(p)

e <- 10
d <- data.frame(x = seq(0.5 + 0.5/e/2 - 0.3, 1.0 - 0.5/e/2 - 0.3, length = e))
d$y <- f(d$x, 2, 5)

prb.est <- sum(d$y * 0.5/e)

p <- ggplot(data.frame(x = c(0, 2)), aes(x))
p <- p + stat_function(fun = f, args = list(a = 2, b = 5))
p <- p + scale_x_continuous(breaks = seq(0, 2, by = 0.1))
p <- p + labs(x = "Reaction Time (sec)", y = "Probability Density")
p <- p + theme_classic() + ylim(0, 1.25)
p <- p + geom_col(aes(y = y), data = d, fill = grey(0.75), alpha = 0.75, color = "black", width = 0.5/e)
p <- p + annotate("text", x = 1.5, y = 1.1, label = paste("Area:", round(prb.est, 4)), size = 4)
plot(p)
```

The actual probability is about `r round(pbeta(0.7/2, 2, 5) - pbeta(0.2/2, 2, 5),4)`.

\pagebreak

## The Normal (Probability) Distribution

One important *family* of continuous probability distributions is the *normal* distribution.

```{r}
m <- 100
s <- 10
```

**Example**: Normal probability distribution with mean $\mu$ = `r m` and standard deviation $\sigma$ = `r s`.
```{r, fig.height = 3, fig.width = 9}
p <- ggplot(data.frame(x = c(m - 3*s, m + 3*s)), aes(x))
p <- p + stat_function(fun = dnorm, args = list(mean = m, sd = s))
p <- p + theme_classic() + labs(x = "x", y = "Probability Density")
p <- p + scale_x_continuous(breaks = seq(m - 3*s, m + 3*s, by = s))
plot(p)
```

## Computing Probabilities from a Normal Distribution

Procedure for computing probabilities from a normal probability distribution.

1. Convert variable value(s) to $z$-score(s) using the formula
$$
  z = \frac{x - \mu}{\sigma},
$$  
where $\mu$ and $\sigma$ are the mean and standard deviation of the distribution, respectively.

2. Use software such as [statdistributions.com](http://www.statdistributions.com/normal) to compute the probability based on the $z$-score(s). Such tools usually use the fact that for any normal distribution, the distribution of the $z$-score has a *standard normal distribution*, which has as mean of zero and a standard deviation of one.

**Example**: Assume a normal probability distribution with mean $\mu$ = `r m` and standard deviation $\sigma$ = `r s`. Confirm the following probabilities.

1. $P(X < 90) \approx `r round(pnorm(90, m ,s), 3)`$.

\vspace{2cm}

2. $P(X > 90) \approx `r round(1 - pnorm(90, m, s), 3)`$.

\vspace{2cm}

3. $P(90 < X < 110) \approx `r round(pnorm(110, m, s) - pnorm(90, m, s), 3)`$. 

\vspace{2cm}

4. $P(80 < X < 120) \approx `r round(pnorm(120, m, s) - pnorm(80, m, s), 3)`$.


