---
title: "Creating a Histogram"
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{array}
output:
  html_document:
    theme: readable
  pdf_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", 
  cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(dplyr)
library(ggplot2)
suppressWarnings(library(kableExtra))
```

```{r}
source("../../utilities.R")
```

This document shows you how to create a histogram from data. But it is also useful for understanding how to interpret a histogram as well since knowing how to interpret it requires knowing how it was made from the data.

```{r}
set.seed(123)
n <- 20
x <- sort(round(rnorm(n, 15, 5), 1))
w <- 2
b <- seq(4, 24, by = w)
```

Consider a sample of $n$ = `r n` observations of a *quantitative* variable.

<center>

`r vecprnt(x, NA)`

</center>

Note that the observations have been sorted so that they are in increasing order. This isn't strictly necessary but it makes the next steps easier. Next we need to select intervals. These intervals should cover all of the observations and should be of the same width. The location and width of the intervals are somewhat arbitrary, but the choice shoudl give a good representation of the distribution without having too many intervals. I have selected `r length(b)-1` intervals starting at `r b[1]` and ending at `r b[length(b)]`, each with a width of `r w`. These are shown in the following table.
```{r}
y <- cut(x, b)

i <- paste(b[-length(b)], "to", b[-1])
f <- as.vector(table(y))
r <- f/n
d <- format(r/w, nsmall = 3)

d <- data.frame(Interval = c(i,""), Frequency = c(f,n), r = c(r,1), Density = c(d,""))
names(d)[3] <- "Relative Frequency"
ktbl(d) %>% column_spec(1:4, width = "2cm")
```
One minor detail to consider is that some observations might fall exactly on the break point between two intervals (e.g., an observation of 14 is on the break point between the interval 12 to 14 and the interval 14 to 16). We simply need a convention to resolve such observations. We will use the convention that such an observation will go in the *lower* interval (e.g., an observation of 14 will be counted as being in 12 to 14, not 14 to 16). 

For each interval the table shows three ways to measure how often observations fall into each interval: *frequency*, *relative frequency*, and *density*. 

1. **Frequency** is simply the *number* of observations in a given interval. For example, there are `r f[4]` observations in the interval `r i[4]`. Note that the sum of all of the frequencies will equal $n$. 

2. **Relative frequency** is the *proportion* of observations in a given interval. It can be computed by dividing the frequency by $n$. For example, the relative frequency of the interval `r i[4]` is `r f[4]`/`r n` = `r f[4]/n`. Note that the sum of the relative frequencies will equal 1.

3. **Density** is the *proportion of observations per unit of the number line*. It can be computed by dividing the relative frequency by the width of the interval. For example, the density of the interval `r i[4]` is `r f[4]/n`/`r w` = `r r[4]/w`. Density is a bit more confusing than frequency or relative frequency, but it has some useful properties. One useful result of using density is that the *area* of a bar equals relative frequency --- i.e., the proportion of observations in that interval. Density is rarely used except in cases where it is desirable to make the intervals have unequal width. 

Now a *histogram* is a graphical representation of the distribution of the quantitative variable that uses the intervals and either frequency, relative frequency, or density. A histogram is essentially a kind of bar graph. The position of each bar on the horizontal axis corresponds to the *interval* --- i.e., the bar must cover the interval it represents. The height of each bar equals either frequency, relative frequency, or density. The figures below show the three kinds of histograms for the data shown earlier.

```{r, fig.height = 4}
p <- ggplot(data.frame(x = x), aes(x = x)) + theme_minimal()
p <- p + geom_histogram(boundary = b[1], binwidth = w, fill = "white", color = "black")
p <- p + labs(y = "Frequency") + scale_x_continuous(breaks = seq(b[1], b[length(b)], by = 1))
p <- p + ggtitle("Histogram Using Frequency")
plot(p)
```

```{r, fig.height = 4, warning = FALSE}
p <- ggplot(data.frame(x = x), aes(x = x, y = w * ..density..)) + theme_minimal()
p <- p + geom_histogram(boundary = b[1], binwidth = w, fill = "white", color = "black")
p <- p + labs(y = "Relative Frequency") + scale_x_continuous(breaks = seq(b[1], b[length(b)], by = 1))
p <- p + ggtitle("Histogram Using Relative Frequency")
plot(p)
```

```{r, fig.height = 4, warning = FALSE}
p <- ggplot(data.frame(x = x), aes(x = x, y = ..density..)) + theme_minimal()
p <- p + geom_histogram(boundary = b[1], binwidth = w, fill = "white", color = "black")
p <- p + labs(y = "Density") + scale_x_continuous(breaks = seq(b[1], b[length(b)], by = 1))
p <- p + scale_y_continuous(breaks = seq(0, 0.125, by = 0.025))
p <- p + ggtitle("Histogram Using Density")
plot(p)
```
Note that the three histograms have the same *shape*. Only the scale of the vertical axis has changed. This is always true (provided that the intervals are all of equal width). So, the choice of frequency, relative frequency, or density is basically a matter of how we want to communicate how "often" observations fall into each interval. 
