---
output:
  html_document: 
    theme: readable
  pdf_document: default
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "01-13-2023"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
output:
  html_document: 
    theme: readable
  pdf_document: default
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
  - \usepackage{array}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(tidyverse)
suppressWarnings(library(kableExtra))
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`

## Distributions

The **distribution** of the observations of a variable gives (a) the values that occur and (b) how often each value occurs. The concept of a distribution is a useful way to characterize the observations in a sample or population.

**Example**: The following is a hypothetical set of observations of examination scores
```{r}
set.seed(123)
y <- rbinom(10, 10, 0.75)
d <- data.frame(y = y) %>% group_by(y) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq))
names(d) <- c("Score","Frequency","Relative Frequency","Cumulative Relative Frequency")
```

<center>

`r paste(y, collapse = ", ")`

</center>

The "how often" is usually described using *frequency* (i.e., how often the value occurs) or *relative frequency* (i.e., the proportion of the observations assume that value). Later we will make use of *cumulative relative frequency* (i.e., the proportion of observations *equal to or less than that observation*).

```{r}
ktbl(d) %>% column_spec(1:4, width = "2cm")
```

```{r}
y <- sample(rep(0:4, c(109,65,22,3,1)))
d <- data.frame(y = y) %>% group_by(y) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq))
names(d) <- c("Deaths","Frequency","Relative Frequency","Cumulative Relative Frequency")
```

**Example**: Consider the following `r length(y)` observations of the number of deaths due to horse or mule kicks in Prussian army units between 1875 and 1894.[^kicks] 

<center>

`r paste(y, collapse = ", ")`

</center>

```{r}
ktbl(d) %>% column_spec(1:4, width = "2cm")
```

[^kicks]: Source: L.\ von Bortkiewicz (1898). *Das Gesertz der kleinen Zhalen*. Teubner, Leipzig.

We can talk about the distribution of a *categorical* variable as well, although we may not use cumulative relative frequency if there is no natural order to the variable values.

**Example**: In one of Gregor Mendel's classic studies, he bred 8023 pea plants and observed the color of the pea pods.

```{r}
d <- data.frame(y = rep(c("yellow","green"), c(6022,2001))) %>% group_by(y) %>% summarize(freq = n()) %>% 
  mutate(relfreq = round(freq/sum(freq),3))
names(d) <- c("Color","Frequency","Relative Frequency")
ktbl(d)
```
Note: Relative frequency has been rounded to the third decimal place.

## Graphical Depictions of Distributions

There are a variety of ways to graph a distribution.

**Example**: Graphical depiction of the distribution of the variable in the first example above.

```{r, fig.height = 4}
set.seed(123)
y <- rbinom(10, 10, 0.75)
d <- data.frame(y = y) %>% group_by(y) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq))
p <- ggplot(d, aes(x = y, y = relfreq)) + theme_minimal()
p <- p + geom_segment(aes(xend = y, yend = 0), color = grey(0.5))
p <- p + geom_point() + labs(x = "x", y = "Relative Frequency")
plot(p)
```

**Example**: Grapical depiction of the distribution of color from Mendel's pea plant study.

```{r, fig.height = 4}
d <- data.frame(y = rep(c("yellow","green"), c(6022,2001))) %>% group_by(y) %>% summarize(freq = n()) %>% mutate(relfreq = round(freq/sum(freq),3))
p <- ggplot(d, aes(x = y, y = relfreq)) + theme_minimal()
p <- p + geom_segment(aes(xend = y, yend = 0), color = grey(0.5))
p <- p + geom_point() + labs(x = "Color", y = "Relative Frequency")
plot(p)
```

Another useful method is what is called a **dot plot**. 

**Example**: Consider a sample of observations of eruption duration of [Old Faithful](https://en.wikipedia.org/wiki/Old_Faithful).
```{r}
d <- faithful %>% select(eruptions) %>% mutate(eruptions = round(eruptions,1)) %>% group_by(eruptions) %>% summarize(freq = n()) %>% mutate(relfreq = round(freq/sum(freq),3))
names(d) <- c("Time","Frequency","Relative Frequency")
ktbl(headtail(as.data.frame(d),5)) %>% column_spec(1:3, width = "2cm")
```

```{r, fig.height = 4}
d <- faithful %>% select(eruptions) %>% mutate(eruptions = round(eruptions,1)) %>% group_by(eruptions) %>% summarize(freq = n()) %>% mutate(relfreq = round(freq/sum(freq),3))
p <- ggplot(d, aes(x = eruptions, y = relfreq)) + theme_minimal()
p <- p + geom_segment(aes(xend = eruptions, yend = 0), color = grey(0.5))
p <- p + geom_point() + labs(x = "Time (min)", y = "Relative Frequency")
plot(p)
```

```{r, fig.height = 5.25}
p <- ggplot(faithful, aes(x = round(eruptions,1)))
p <- p + geom_dotplot(binwidth = 0.1, stackdir = "up", method = "histodot", origin = min(round(faithful$eruptions)) - 0.05)
p <- p + theme_bw() + labs(x = "Time (min)")
p <- p + theme(axis.title.y = element_blank(), axis.text.y = element_blank(),
  axis.ticks.y = element_blank()) 
p <- p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p <- p + theme(axis.line.y = element_blank())
p <- p + theme(panel.border = element_blank(), axis.line.x = element_line())
plot(p)
```

**Example**: Dot plots of samples of observations of beak size for [Finches on Daphne Major (Galapagos Islands)](https://en.wikipedia.org/wiki/Darwin%27s_finches) from before (1976) and after (1978) a drought in 1977.[^grant]
```{r, fig.height = 2.6}
tmp <- Sleuth3::ex0218 %>% group_by(Year) %>% summarize(mean = mean(Depth))
p <- ggplot(Sleuth3::ex0218, aes(x = Depth)) + facet_grid(. ~ Year)
p <- p + geom_dotplot(binwidth = 0.1, stackratio = 1.1, stackdir = "up", method = "histodot")
p <- p + theme_minimal() + labs(x = "Beak Depth (mm)")
p <- p + geom_point(aes(x = mean, y = -0.05), data = tmp, shape = 17, size = 2)
p <- p + noyaxis
plot(p)
```

[^grant]: Grant, P. (1986). *Ecology and evolution of Darwin's finches*. Princeton, N.J.: Princeton University Press.

**Example**: Creative writing students were "primed" with either extrinsic or intrinsic motivation.[^motivation] They were then asked to write a poem in the Haiku style about laughter. Each poem was then scored for "creativity" on a 40-point scale by judges.

```{r, fig.height = 2}
d <- Sleuth3::case0101 %>% mutate(Score = round(Score)) %>% group_by(Treatment, Score) %>% summarize(Frequency = n())

d.extrinsic <- subset(d, Treatment == "Extrinsic")
d.intrinsic <- subset(d, Treatment == "Intrinsic")

ktbl(headtail(as.data.frame(d.extrinsic), 3))
ktbl(headtail(as.data.frame(d.intrinsic), 3))

p <- ggplot(subset(Sleuth3::case0101, Treatment == "Extrinsic"), aes(x = round(Score)))
p <- p + geom_dotplot(binwidth = 1) + theme_classic()
p <- p + noyaxis + nogrid + ggtitle("Extrinsic Motivation")
p <- p + xlab("Creativity Score") + scale_x_continuous(breaks = 5:30, limits = c(5,30))
plot(p)

p <- ggplot(subset(Sleuth3::case0101, Treatment == "Intrinsic"), aes(x = round(Score)))
p <- p + geom_dotplot(binwidth = 1) + theme_classic()
p <- p + noyaxis + nogrid + ggtitle("Intrinsic Motivation")
p <- p + xlab("Creativity Score") + scale_x_continuous(breaks = 5:30, limits = c(5,30))
plot(p)
```

[^motivation]: Amabile, T. (1985). Motivation and creativity: Effects of motivational orientation on creative writers. *Journal of Personality and Social Psychology*, *48(2)*, 393--399.

## Histograms

A **histogram** is a specialized type of bar graph for showing the distribution of a *quantitative variable*. I have written a more detailed [tutorial](histograms.html) on how to create a histogram "by hand" with a manageable number of observations. 

**Example**: Here are the "raw" data from the sample of observations of eruption time of Old Faithful, sorted in increasing order for convenience. 

`r vecprnt(sort(round(faithful$eruption, 1)), conjunction = NA)`

```{r}
w <- 0.5
b <- seq(1.5, 5.5, by = w)

d <- faithful %>% mutate(eruptions = cut(round(eruptions, 1), breaks = b, labels = paste(b[-length(b)], "to", b[-1]))) %>% select(eruptions) %>% group_by(eruptions) %>% summarize(freq = n()) %>% mutate(relfreq = round(freq/sum(freq),2))
names(d) <- c("Time","Frequency","Relative Frequency")
ktbl(d) %>% column_spec(1:3, width = "2cm")
```
Note: The intervals used are a matter of choice. But they should all be of the same width (here 0.5 minutes). Also we need a convention for when an observation falls on the border between two intervals. In my histograms such observations are always put in the *lower* interval. 

The histogram is then drawn with the horizontal position of the bars corresponding to the interval, and the height of the bars corresponding to frequency *or* relative frequency.
```{r, fig.height = 3, warning = FALSE}
p <- ggplot(faithful, aes(x = round(eruptions,1))) + theme_classic()
p <- p + geom_histogram(boundary = b[1], binwidth = w, fill = "white", color = "black")
p <- p + labs(y = "Frequency", x = "Time (min)") + scale_x_continuous(breaks = seq(b[1], b[length(b)], by = w))
p1 <- p

p <- ggplot(faithful, aes(x = round(eruptions,1), y = w * ..density..)) + theme_classic()
p <- p + geom_histogram(boundary = b[1], binwidth = w, fill = "white", color = "black")
p <- p + labs(y = "Relative Frequency", x = "Time (min)") + scale_x_continuous(breaks = seq(b[1], b[length(b)], by = w))
p2 <- p

cowplot::plot_grid(p1, p2, nrow = 1)
```

**Example**: Here are some histograms of the finch data.

```{r, fig.width = 9}
p <- ggplot(Sleuth3::ex0218, aes(x = Depth)) + facet_grid(Year ~ .)
p <- p + theme_minimal() + labs(x = "Beak Depth (mm)", y = "Relative Frequency")
p <- p + geom_histogram(aes(x = Depth, y = 0.5 * ..density..), 
  breaks = seq(6, 15, by = 0.5), fill = "white", color = "black")
p <- p + scale_x_continuous(breaks = c(6:15))
plot(p)
```

## Summary Measures of a Distribution

A couple of properties of a distribution that we often want to measure are *location* and *variability*. Such properties are statistics (if the distribution is of the observations in a sample) or parameters (if the distribution is of the observations in a population). 

### Measures of Location

The (arithmetic) **mean** is simply the average of the observations. This can be written as 
$$
  \bar{x} = \frac{x_1 + x_2 + \dots + x_n}{n} = \frac{\sum_{i=1}^n x_i}{n}
$$
or 
$$
  \bar{x} = \frac{1}{n}\sum_{i=1}^n x_i.
$$

An alternative formula based on frequencies or relative frequencies can be written as
$$
  \bar{x} = \frac{1}{n} \sum_x x f(x) \ \ \ \text{or} \ \ \ \bar{x} = \sum_x x r(x)
$$
where the summation is over all *distinct* values of the variable, and $f(x)$ is the *frequency* of the value of $x$, and $r(x)$ is the *relative frequency* of the value $x$. 

**Example**: Consider again the distribution of the number of deaths due to horse and mule kicks in Prussian army units.
```{r}
y <- sample(rep(0:4, c(109,65,22,3,1)))
d <- data.frame(y = y) %>% group_by(y) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq)) %>% 
  select(y, freq, relfreq) %>% mutate(yrelfreq = y * relfreq)
d <- rbind(d, c("Total", sum(d$freq), 1, sum(d$yrelfreq)))
names(d) <- c("Deaths","Frequency","Relative Frequency","Deaths $\\times$ Relative Frequency")

ktbl(d) %>% column_spec(1:4, width = "2cm")
```
The mean is $\bar{x}$ = `r mean(y)`. 

Note: The mean can be interpreted as the "balance point" of the distribution.

\pagebreak

The **median** is defined as the "middle" value when the observations are sorted in increasing order, or the average of the two middle values if the number of observations is even.

**Example**: Consider the following 9 observations of a quantitative variable. 

```{r}
y <- rbinom(10, 10, 0.75)
```

<center>

`r paste(sort(y[1:(length(y)-1)]), collapse = ", ")`

</center>

**Example**: Consider the following 10 observations of a quantitative variable.

<center>

`r paste(sort(y), collapse = ", ")`

</center>

The **mode** is the value with the largest (relative) frequency. 

1. The mode can be used with *categorical* variables, but the median and mean cannot.
0. The mode may not be unique if there are two or more most frequent values. 








