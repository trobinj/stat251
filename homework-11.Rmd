---
title: "Homework Problem Set 11: Statistical Tests Concerning $\\mu$"
output: 
  html_document: 
    theme: readable
header-includes:
  - \usepackage{array}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", 
  cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(tidyverse)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](homework-11.pdf) copy of this homework assignment.", sep = ""), "")`

```{r}
tstat <- function(x, s, n, m0 = 0) {
  (x - m0)/(s/sqrt(n))
}
pval <- function(t, n, side = "two") {
  switch(side, 
    two = 2 * pt(-abs(t), n-1),
    left = pt(t, n-1),
    right = 1 - pt(t, n-1))
}
```

Instructions: These homework problems will help familiarize you with the process of conducting a statistical test concerning $\mu$. For each problem conduct *four* steps of the statistical test (state the hypotheses, compute test statistic, compute p-value, make a decision --- you can skip checking the sample size and distribution). Use a significance level of $\alpha$ = 0.05 for all tests. The solutions are given at the end.[^rounding]

[^rounding]: In the solutions the reported values of test statistics and p-values have been rounded to the second and third decimal place, respectively. Rounding was only done for the final reported values. It was avoided in intermediate calculations (e.g., the value of the test statistic used to compute a p-value was *not* rounded).

## Darwin's Corn Seedling Study  

Recall Charles Darwin's study that compared the heights of corn seedlings produced by cross-fertilization with those produced from self-fertilization.[^darwin] He used a *matched-pairs* design that is not unlike the twin study of schizophrenia discussed in class. Pairs of seedlings were collected from the same parent plant, but one was produced from cross-fertilization and the other was produced from self-fertilization. To compare the seedlings we can compute the *difference* in height between the seedlings within each pair --- specifically the height of the seedling produced from cross-fertilization minus that of the seedling produced from self-fertilization. The figure below shows the distribution of the height differences for the 15 pairs of seedlings.
```{r, fig.height = 1.5}
d <- HistData::ZeaMays
p <- ggplot(d, aes(x = round(diff, 1)))
m <- with(d, mean(diff))
p <- p + geom_dotplot(binwidth = 0.1) + theme_bw()
p <- p + theme_classic() + noyaxis
p <- p + theme(axis.title.y = element_blank(), axis.text.y = element_blank(), axis.ticks.y = element_blank())
p <- p + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
p <- p + labs(x = "Height Difference (in)")
p <- p + geom_point(aes(x = m, y = -0.1), pch = 17)
plot(p)
```
Darwin's motivation for this study was to show that cross-fertilization tends to result in plants that are more fit than self-fertilization. If this is true then it would be expected that the seedlings produced by cross-fertilization would be taller, on average, than those produced by self-fertilization. The data appear to support this claim as the mean difference is about `r with(d, round(mean(diff), 2))` inches, although there is some variation in the difference as shown by the standard deviation of `r with(d, round(sd(diff), 2))`. Conduct a statistical test to determine if there is evidence that corn seedlings produced by cross-fertilization are taller, on average, than those produced by self-fertilization.

[^darwin]: Darwin, C. (1876). *The effect of cross- and self-fertilization in the vegetable kingdom* (2nd ed). London: John Murray.

## Generalized Reciprocity in Rats

This problem is based on data from a study of *generalized reciprocity*.[^reciprocity] Reciprocity is when an organism helps another organism in return for that organism helping them. *Generalized* reciprocity is when the organism that was helped helps another organism, but not the organism from which they received help. Rats were trained to learn that they could pull a lever that would "help" another rat by providing a small bit of food. The study then used a cross-over design to observe the number of pulls per minute made by each rat under each of two treatment conditions: one where the rat had recently received help from another rat (by providing it food using the same mechanism), and another where the rat had not recently received such help. The order of the treatments was randomized and the observations made under the two treatment conditions were separated in time. The figures below show the number of pulls per minute for each rat under each treatment condition, as well as the difference in the number of pulls per minute (pulls per minute in the help condition minus the pulls per minute in the no help condition).
```{r, fig.height = 2.25}
d <- trtools::reciprocity
d$rat <- 1:nrow(d)
d <- reshape2::melt(d, measure.var = c("help","nohelp"),
  variable.name = "treatment", value.name = "rate")
levels(d$treatment) <- c("help", "no help")

p <- ggplot(d, aes(x = factor(rat), y = rate)) + theme_minimal() + coord_flip()
p <- p + geom_point(aes(shape = treatment, fill = treatment))
p <- p + scale_shape_manual(values = c(18,22))
p <- p + scale_fill_manual(values = c("black",NA))
p <- p + labs(x = "Rat", y = "Pulls/Minute", shape = "Treatment", fill = "Treatment")
p <- p + theme(legend.key = element_rect(fill = "transparent", colour = "transparent"))
p <- p + theme(axis.text = element_text(size = 5))
p1 <- p + theme(legend.position = c(0.8,0.2))

d <- trtools::reciprocity
d$rat <- 1:nrow(d)
p <- ggplot(d, aes(x = factor(rat), y = help - nohelp))
p <- p + geom_point(shape = 21, fill = "black", size = 0.75) + theme_minimal() + coord_flip()
p <- p + labs(x = "", y = "Difference")
p <- p + theme(axis.text = element_text(size = 5))
p2 <- p

cowplot::plot_grid(p1, p2, ncol = 2, align = "h", rel_widths = c(0.6, 0.4))
```
There is what appears to be a tendency for rats to pull the level more frequently after they have been helped, but it is not (yet) clear if this is a statistically significant result. The mean difference in pulls per minute is about `r with(trtools::reciprocity, round(mean(help - nohelp), 2))` pulls per minute, and the standard deviation is about `r with(trtools::reciprocity, round(sd(help - nohelp), 2))` pulls per minute based on a sample of `r nrow(trtools::reciprocity)` observations. If rats exhibit generalized reciprocity then they should pull more often, on average, after they have been recently helped themselves. Conduct a statistical test to determine if there is evidence of generalized reciprocity.

[^reciprocity]: Rutte, C. \& Taborsky, M. (2007). Generalized reciprocity in rats. *PLoS Biol*, *5(7)*: e196. doi:10.1371/journal.pbio.0050196.

```{r}
n.hobbit <- 100
m.hobbit <- 2
s.hobbit <- 20
```

## Running Times to Second Base

Each of 22 baseball players ran from home plate to second base two times for each of three routes: *round*, *narrow*, and *wide*.[^woodward] These routes are illustrated in the figure below (the routes have been exaggerated slightly for illustration). 
```{r, echo = FALSE, fig.asp = 0.9, out.width = "60%"}
f <- function(x, y, ...) {
  tmp <- Hmisc::bezier(x,y)
  lines(tmp$x, tmp$y, ...)
}

par(mai = c(0,0,0,0))

xs <- 0.7
ys <- 0.7

plot.new()
plot.window( xlim=c(-5,6)/xs, ylim=c(0,10)/ys)
lines(x = c(0,5)/xs, y = c(0,5)/ys)
lines(x = c(0,-5)/xs, y = c(0,5)/ys)
lines(x = c(5,0)/xs, y = c(5,10)/ys)
lines(x = c(0,-5)/xs, y = c(10,5)/ys)

# home plate
lines(x = c(0.25,0.25)/xs, y = c(0.25,0.5)/ys)
lines(x = -c(0.25,0.25)/xs, y = c(0.25,0.5)/ys)
lines(x = c(-0.25,0.25)/xs, y = c(0.5,0.5)/ys)

# first base
lines(x = c(4.75, 4.5)/xs, y = c(4.75, 5)/ys)
lines(x = c(4.5,4.75)/xs, y = c(5,5.25)/ys)

# second base
lines(x = c(0, 0.25)/xs, y = c(9.5,9.75)/ys)
lines(x = -c(0, 0.25)/xs, y = c(9.5,9.75)/ys)

# third base
lines(x = -c(4.75, 4.5)/xs, y = c(4.75, 5)/ys)
lines(x = -c(4.5,4.75)/xs, y = c(5,5.25)/ys)

# round
f(x = c(3,4,6,5)/xs, y = c(3,4,4,5)/ys, lty = 2)

# narrow
f(x = c(0, 3, 5, 5)/xs, y = c(0, 2.5, 3.5, 5)/ys, lty = 3)
f(x = c(0, 3, 5, 5)/xs, y = c(10, 10-2.5, 10-3.5, 10-5)/ys, lty = 3)

# wide
f(x = c(0,3.5,6.5,5)/xs, y = c(0,3,3.5,5)/ys, lty = 4)

legend(3/xs, 1.5/ys, bty = "n", lty = 2:4, legend = c("round","narrow","wide"))
```
In class we compared with narrow and wide routes. In this problem you will compare the *round* and *wide* routes. The running times for these routes are shown below as well as the difference in the running times for each player.
```{r}
d <- trtools::baserun %>% select(round, wide) %>% mutate(player = 1:n(), difference = round - wide) %>% select(player, round, wide, difference) 

m <- round(mean(d$difference),2)
s <- round(sd(d$difference),2)

d <- d %>% mutate(difference = as.character(round(difference,2)))
names(d) <- c("Player","round","wide","Difference")
headtail(d, 5) %>% ktbl()  %>% add_header_above(c(" " = 1, "Route" = 2, " " = 1))
```
(Note: The running times are the average of two runs between a point 35 feet from home plate to a point 15 feet short of second base.) For the sample of observations, the mean difference is `r m` seconds, and the standard deviation is `r s` seconds. Is a mean difference of `r m` seconds statistically significant?

[^woodward]: Woodward, W. F. (1970). A comparison of base running methods in baseball. MSc Thesis, Florida State University.

## Effect of Cell Phone Use on Driving Reaction Times

```{r}
set.seed(101)
y.phone <- round(rnorm(32, 585, 90)) - round(rnorm(32, 534, 65))
```

A study published in *Psychological Science* investigated the effect of cell phone use on reaction time in a simulated driving task.[^cellphone] That study used two separate groups of subjects. We will discuss how to make inferences from such a design later. Here we will consider a similar but fictional study that instead used a cross-over design. Suppose that `r length(y.phone)` subjects were each put through two treatments. In each treatment the subject was required to attend to a task on a computer that requires that they react to events during the task. This task is designed to simulate the level of attention necessary for driving. In the control condition the subjects listened to a radio station or audiobook of their choice. In the other condition the subjects were required to engage in a conversation with another person on a phone. The order in which the subjects went through the two treatment conditions was randomized, and the two sessions were separated by several days. The researchers recorded the mean reaction time during the simulated driving task for each subject under each condition. To compare the two conditions we can compute the difference in mean reaction time between the two conditions (reaction time during the phone condition minus that during the control condition). The mean difference was about `r round(mean(y.phone),1)` msec, and the standard deviation was `r round(sd(y.phone),1)` msec. Conduct a statistical test to determine if there is evidence of a statistically significant difference in reaction time between the two treatment conditions. 

[^cellphone]: Strayer, D. L. & Johnston, W. A. (2001). Driven to distraction: Dual-task studies of simulated driving and conversing on a cellular telephone. *Psychological Science*, *12(6)*, 462--466.

***

\pagebreak

## Darwin's Corn Seedling Study (Solutions)

```{r}
m <- with(HistData::ZeaMays, round(mean(diff), 2))
s <- with(HistData::ZeaMays, round(sd(diff), 2))
n <- with(HistData::ZeaMays, length(diff))
```

Here we can let $\mu$ denote the mean difference in seed height in the population distribution of observations. Appropriate hypotheses would then be $H_0\!:\mu=0$ and $H_a\!:\mu > 0$. The one-sided test seems justified here because Darwin believed that seedlings produced by cross-fertilization would be taller, on average, than those produced by self-fertilization. The observed value of the test statistic is `r rnd(tstat(m, s, n, 0), 2)` which yields a p-value of `r rnd(pval(tstat(m, s, n, 0), n, side = "right"), 3)`. For a two-sided test the p-value would be twice as large as that for the one-sided test. The decision would be to reject the null hypothesis since the p-value is not larger than the significance level, and so we would conclude that the fact that the mean difference in seedling height is greater than zero is statistically significant. The study and analysis support the claim that cross-fertilization results in taller corn seedlings, on average, in comparison to self-fertilization. 

## Generalized Reciprocity in Rats (Solutions)

```{r}
m <- with(trtools::reciprocity, round(mean(help - nohelp), 2))
s <- with(trtools::reciprocity, round(sd(help - nohelp), 2))
n <- with(trtools::reciprocity, length(help - nohelp))
```

Here we let $\mu$ denote the mean difference in pulls per minute between the help and no help treatment conditions in the population distribution of observations. Appropriate hypotheses would then be $H_0\!: \mu = 0$ and $H_a\!: \mu > 0$. If generalized reciprocity is exhibited by rats then the level pulling frequency would be higher in the help treatment condition so the one-sided test seems reasonable, although you could have considered a two-sided test with $H_a\!: \mu \neq 0$. The observed value of the test statistic is `r rnd(tstat(m, s, n, 0), 2)` and the p-value is `r rnd(pval(tstat(m, s, n, 0), n, side = "right"), 3)`. For a two-sided test the p-value would be twice as large. Since the p-value is less than $\alpha$ our decision is to reject the null hypothesis and conclude that the mean difference in pulls per minute is statistically significant. This study and analysis does suggest that rats exhibit generalized reciprocity. 

## Running Times to Second Base (Solutions)

```{r}
d <- trtools::baserun %>% select(round, wide) %>% mutate(player = 1:n(), difference = round - wide) %>% select(player, round, wide, difference) 

m <- round(mean(d$difference),2)
s <- round(sd(d$difference),2)
n <- 22
```

Let $\mu$ be the mean difference in running time between the round and wide routes for a population distribution of observations. Appropriate hypotheses would then be $H_0\!: \mu = 0$ versus $H_a\!: \mu \neq 0$. A two-sided test is being used here since we do not have any information about what route might be faster. The observed value of the test statistic is `r rnd(tstat(m, s, n),2)`. The p-value is then `r rnd(pval(tstat(m, s, n), 22, "two"), 2)`. This would lead us to reject the null hypothesis and conclude that the fact that the mean difference in running times is greater than zero is statistically signficiant. We would conclude that the running time for the round route is, on average, longer than the wide route.

## Effect of Cell Phone Use on Driving Reaction Times (Solutions)

We can let $\mu$ denote the mean difference in reaction time for the population distribution. Appropriate hypotheses would be $H_0\!: \mu = 0$ and $H_a\!: \mu > 0$. It seems reasonable to use the one-sided alternative with the expectation that if cell phone use has any effect it would increase reaction time, but you could also have used $H_a: \mu \neq 0$. The value of the test statistic is `r rnd(tstat(round(mean(y.phone),1), round(sd(y.phone),1), length(y.phone), 0), 2)`. For the one-sided test the p-value would then be `r rnd(pval(tstat(round(mean(y.phone),1), round(sd(y.phone),1), length(y.phone), 0), length(y.phone), side = "right"), 3)`. For a two-sided test the p-value would be twice as large. Since the p-value is less than $\alpha$, the conclusion would be to reject the null hypothesis. The different in mean reaction time is statistically significant. The results of the study and the analysis suggest that cell phone use does increase reaction time on average.

```{r}
rm(list = ls())
```

