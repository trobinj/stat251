---
output:
  html_document:
    theme: readable
  pdf_document: default
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "01-21-2022"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.width = 9, fig.align = "center", cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`

## Normal ("Bell-Shaped") Distributions

**Example**: Consider the distribution of the observations of the heights of adult men and women in the United States. 

1. For **men** the mean and standard deviation would be about **69** and **3** inches, respectively.

2. For **women** the mean and standard deviation would be about **63.5** and **2.5** inches, respectively.

Also those distributions would be approximately *normal* or *bell-shaped* (or sometimes *Gaussian*). 

```{r, fig.height = 3, fig.width = 9}
set.seed(101)
n <- 100000
d <- data.frame(height = c(scale(rnorm(n))*3 + 69, scale(rnorm(n))*2.5 + 63.5), sex = rep(c("Men","Women"), each = n))
d$sex <- factor(d$sex, levels = c("Women","Men"))
breaks <- with(d, seq(floor(min(height)), ceiling(max(height)), by = 0.5))
p <- ggplot(d, aes(x = height, y = ..density.. * 0.5, fill = sex))
p <- p + geom_histogram(breaks = breaks, color = "black", alpha = 0.5, position = "identity")
p <- p + labs(x = "Height (in)", y = "Relative Frequency", fill = "Gender")
p <- p + theme_classic() + theme(legend.position = c(0.8, 0.8))
plot(p)
```

\pagebreak

### Relationship with Mean and Standard Deviation

The *shape* of a normal distribution is related to its mean and standard deviation. 

1. The mean is located where the (relative) frequency is at its peak.

0. The standard deviation is the distance from the mean to the value of the variable where the (relative) frequency is a little more than half way (actually about 61%) to its maximum.

**Example**: Consider the distributions of the heights of adult men and women.
```{r, fig.height = 7, fig.width = 9}
ugh <- data.frame(height = seq(min(d$height), max(d$height), length = 1000))
ugh$y <- dnorm(ugh$height, 69, 3)

p <- ggplot(subset(d, sex == "Men"), aes(x = height, y = ..density.. * 0.5))
p <- p + geom_histogram(breaks = breaks, color = "black", alpha = 0.5, position = "identity", fill = "#00BFC4")
p <- p + labs(x = "Height (in)", y = "Relative Frequency", fill = "Gender")
p <- p + theme_classic() + theme(legend.position = c(0.8, 0.8))
p <- p + scale_x_continuous(breaks = c(69 + c(-1,0,1)*3))
p <- p + geom_density(adjust = 2) + ylim(0, 0.08)

pm <- p

ugh <- data.frame(height = seq(min(d$height), max(d$height), length = 1000))
ugh$y <- dnorm(ugh$height, 63.5, 2.5)

p <- ggplot(subset(d, sex == "Women"), aes(x = height, y = ..density.. * 0.5))
p <- p + geom_histogram(breaks = breaks, color = "black", alpha = 0.5, position = "identity", fill = "#F8766D")
p <- p + labs(x = "Height (in)", y = "Relative Frequency", fill = "Sex")
p <- p + theme_classic() + theme(legend.position = c(0.8, 0.8))
p <- p + scale_x_continuous(breaks = c(63.5 + c(-1,0,1)*2.5))
p <- p + geom_density(adjust = 2) + ylim(0, 0.08)
pw <- p

cowplot::plot_grid(pm, pw, nrow = 2, align = "v")
```

**Example**: Suppose that the distribution of Hobbit height is normal in shape with a mean of 107 cm and a standard deviation of 10 cm. How could we plot an outline of this distribution?

\vspace{3cm}

\pagebreak

### The "Empirical Rule" for Normal Distributions

```{r}
lbls <- c("$\\bar{x} - 3s$", "$\\bar{x} - 2s$", "$\\bar{x} - s$", "$\\bar{x}$", 
          "$\\bar{x} + s$", "$\\bar{x} + 2s$", "$\\bar{x}+3s$")
for (i in 1:7) {
  lbls[i] <- tex(lbls[i])
}

d <- data.frame(x = seq(-3.5, 3.5, length = 1000)) %>% 
  mutate(y = dnorm(x))

u <- data.frame(x = -3:3) %>% mutate(y = dnorm(x))

p <- ggplot(d, aes(x = x, y = y)) + theme_minimal()
p <- p + geom_segment(aes(xend = x, yend = 0), linetype = 3, data = u)
p <- p + geom_line() + coord_cartesian(xlim = c(-3.5, 3.5))
p <- p + scale_x_continuous(breaks = -3:3, labels = lbls)
p <- p + scale_y_continuous(labels = NULL) + labs(x = tex("$x$"), y = "Relative Frequency")
p1 <- p

d <- data.frame(x = seq(-3.5, 3.5, length = 1000)) %>% 
  mutate(y = pnorm(x))

u <- data.frame(x = -3:3) %>% mutate(y = pnorm(x))

p <- ggplot(d, aes(x = x, y = y)) + theme_minimal()
p <- p + geom_segment(aes(xend = x, yend = 0), linetype = 3, data = u)
p <- p + geom_segment(aes(yend = y, xend = -10), linetype = 3, data = u)
p <- p + geom_line() + coord_cartesian(xlim = c(-3.5, 3.5))
p <- p + scale_x_continuous(breaks = -3:3, labels = lbls)
p <- p + scale_y_continuous(breaks = u$y, labels = round(u$y, 3), minor_breaks = NULL)
p <- p + labs(x = tex("$x$"), y = "Cumulative Relative Frequency")
p2 <- p
```

```{r, fig.height = 5, fig.width = 9}
plot(p1)
```

If a distribution is normal then we know the following.

1. Approximately 68% of observations are within *one* standard deviation of the mean.
2. Approximately 95% of observations are within *two* standard deviations of the mean.
3. Approximately 100% of observations are within *three* standard deviations of the mean.

**Example**: Where would we find the middle 68%, 95%, and almost all of the observations of Hobbit height if the distribution of Hobbit height is normal in shape with a mean of 107 cm and a standard deviation of 10 cm?

\vspace{2cm}

**Example**: Where are the middle 95% of observations of the heights of men if the distribution of the heights of men is approximately normal with a mean of 69 and a standard deviation of 3?

\vspace{2cm}

**Example**: Where are the middle 95% of observations of the heights of women if the distribution of the heights of women is approximately normal with a mean of 63.5 and a standard deviation of 2.5?

\vspace{2cm}

\pagebreak

The percents stated in the empirical rule are based on percentiles.
```{r, fig.height = 9, fig.width = 9}
plot(p2)
```

\pagebreak

**Example**: Suppose I flipped a coin 200 times and observed the number of times it came up heads. Now suppose I did this many thousands of times to get a sample of observations of the number of times the coin comes up heads when flipped 200 times. The plot below shows the distribution of the number of times the coin comes up heads out of 200 flips.
```{r, fig.width = 9, fig.height = 5}
n <- 200
p <- 0.5

d <- data.frame(x = 0:n) %>% mutate(y = dbinom(x, n, p))

m <- n*p
s <- sqrt(n*p*(1-p))

g <- ggplot(d, aes(x = x, y = y)) + theme_minimal()
g <- g + geom_segment(aes(xend = x, yend = 0), alpha = 0.5)
g <- g + geom_point() + labs(x = "Number of Heads", y = "Relative Frequency")
g <- g + scale_x_continuous(breaks = seq(0, n, by = 10))
g <- g + scale_y_continuous(breaks = seq(0, 1, by = 0.01))
plot(g)
```
This distribution is clearly normal in shape, and it has a mean of `r m` and a standard deviation of `r rnd(s, 0)`. What does the empirical rule tell us about where we would expect (or not expect) about the number of heads out of 200 flips?

\pagebreak

### Standard Scores (i.e., *z*-Scores)

A $z$-score is computed as 
$$
  z = \frac{x - \bar{x}}{s}.
$$
It is the number of standard deviations $x$ is above (if $z$ > 0) or below (if $z$ < 0) the mean.

**Example**: Tim is 74 inches tall. Kristine is 70 inches tall. What are their $z$-scores? Is Tim taller for a man or is Kristine taller for a woman?

\vspace{3cm}

**Example**: A man is five inches above average (for men) in height. A woman is also five inches above average (for women) in height. Who is taller *relative* to the distribution of adults of the same gender? 

\vspace{3cm}

**Example**: Consider again the sample of coin flips, but now suppose that we look at the *proportion* of flips that come up heads, and we do so out of 100 flips and again out of 400 flips. The distribution for 100 flips has a mean of 0.5 and a standard deviation of 0.05, while the distribution of 400 flips has a mean of 0.5 and a standard deviation of 0.025. What is the $z$-score for each distribution if we observe that the coin comes up heads on 55% of the trials (i.e., a proportion of 0.55)?

```{r, warning = FALSE}
n <- 400
p <- 0.5

d1 <- data.frame(x = 0:n) %>% mutate(y = dbinom(x, n, p)) %>% 
  mutate(x = x/n, n = paste(n, "flips"))

n <- 100

d2 <- data.frame(x = 0:n) %>% mutate(y = dbinom(x, n, p)) %>% 
  mutate(x = x/n, n = paste(n, "flips"))

d <- rbind(d1, d2)

g <- ggplot(d, aes(x = x, y = y)) + theme_minimal() + facet_wrap(~ n)
g <- g + geom_segment(aes(xend = x, yend = 0), alpha = 0.5)
g <- g + geom_point() + 
  labs(x = "Proportion of Flips that Come Up Heads", y = "Relative Frequency", color = "Flips")
g <- g + scale_y_continuous(breaks = seq(0, 1, by = 0.01), limits = c(0, 0.08))
g <- g + scale_x_continuous(breaks = seq(0, 1, by = 0.05), limits = c(0.35, 0.65))
plot(g)
```
