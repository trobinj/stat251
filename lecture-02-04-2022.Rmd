---
output:
  html_document:
    theme: readable
  pdf_document: default
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "02-04-2022"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
header-includes:
  - \usepackage{float}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.width = 9, fig.align = "center", cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`


## Deriving a Sampling Distribution (the "Five-Step Method")

We can derive the probability distribution of a statistic (i.e., a *sampling distribution*) given the probability distribution of a single observation (i.e., a *population distribution*) by using the following steps.

1. Create the sample space which consists of all possible samples.

2. Compute the probability of each sample in the sample space.

3. Compute the value of the statistic for each sample in the sample space.

4. Create a table of the possible values of the statistic.

5. Compute the probability of each value of the statistic.

A **sample space** is the set of all possible samples of observations.

\pagebreak

## Sampling Distribution of a Mean

**Example**: Suppose we have a forest of trees of which 60% have a volume of 20 cubic feet, and 40% have a volume of 30 cubic feet. What would be the sampling distribution of the mean volume based on a random sample of the $n$ = 2 trees? (Note: We are going to assume for now that we are *sampling with replacement*, meaning that we could select the same tree more than once.)

```{r}
popd <- data.frame(Volume = c(20,30), Probability = c(0.6,0.4))

outc <- c("20, 20","20, 30","30, 20","30, 30")
prob <- c("0.6 $\\times$ 0.6 = 0.36","0.6 $\\times$ 0.4 = 0.24","0.4 $\\times$ 0.6 = 0.24","0.4 $\\times$ 0.4 = 0.16")
#prob <- c("0.36","0.24","0.24","0.16")
mean <- c(20,25,25,30)

outc <- data.frame(Sample = outc, Probability = prob, mean = mean)
samp <- data.frame(mean = c(20,25,30), Probability = c(0.36,"0.24 + 0.24 = 0.48",0.16))

names(popd) <- c("$x$","$P(x)$")
names(outc)[3] <- c("$\\bar{x}$")
names(samp) <- c("$\\bar{x}$","$P(x)$")
```

```{r}
ktbl(popd, caption = "Population Distribution")
ktbl(outc, caption = "Sample Space")
ktbl(samp, caption = "Sampling Distribution")
```

Note: We are using two properties of probabilities from probability theory here.

1. The probability of two or more events happening together (e.g., A *and* B) equals the *product* of their probabilities *if* the events are *independent*, meaning that the probability of each event does not change depending on if the other events have or have not occurred. 

2. The probability that at least one of two or more events happening (e.g., A *or* B) equals the *sum* of their probabilities *if* the events are *mutually exclusive*, meaning that the events cannot both occur at the same time.

\pagebreak

**Example**: What is the sampling distribution of the mean of a sample of $n$ = 2 observations of the throwing distance of the trebuchet?

```{r}

popd <- data.frame(Distance = 1:3, Probability = c(0.1, 0.3, 0.6))

outc <- c("1, 1","1, 2","1, 3","2, 1","2, 2","2, 3","3, 1","3, 2","3, 3")
#outc <- paste("$", outc, "$", sep = "")
prob <- c("0.1 $\\times$ 0.1 = 0.01", "0.1 $\\times$ 0.3 = 0.03", "0.1 $\\times$ 0.6 = 0.06",
  "0.3 $\\times$ 0.1 = 0.03", "0.3 $\\times$ 0.3 = 0.09", "0.3 $\\times$ 0.6 = 0.18", 
  "0.6 $\\times$ 0.1 = 0.06", "0.6 $\\times$ 0.3 = 0.18", "0.6 $\\times$ 0.6 = 0.36")
prob <- c("0.01", "0.03", "0.06",
  "0.03", "0.09", "0.18", 
  "0.06", "0.18", "0.36")
#prob <- paste("$", prob, "$", sep = "")
mean <- c(1,1.5,2,1.5,2,2.5,2,2.5,3)
outc <- data.frame(Sample = outc, Probability = prob, mean)
names(popd) <- c("$x$","$P(x)$")
names(outc)[3] <- "$\\bar{x}$"

mean <- c(1,1.5,2,2.5,3)
prob <- c(0.01,0.06,0.21,0.36,0.36)
samp <- data.frame(mean = mean, Probability = prob)
names(samp) <- c("$\\bar{x}$","$P(\\bar{x})$")
```

```{r}
ktbl(popd, caption = "Population Distribution")
ktbl(outc, caption = "Sample Space")
ktbl(samp, caption = "Sampling Distribution")
```

\pagebreak

**Example**: We can find the sampling distribution of any statistic in the same way. What is the sampling distribution of the sample variance ($s^2$) based on a sample of $n$ = 2 observations?

```{r}
outc[,3] <- c(0,0.5,2,0.5,0,0.5,2,0.5,0)
names(outc)[3] <- "$s^2$"
stat <- c(0,0.5,2)
prob <- c(sum(c(0.01,0.09,0.36)), sum(c(0.03,0.03,0.18,0.18)), sum(c(0.06,0.06)))
samp <- data.frame(var = stat, Probability = prob)
names(samp) <- c("$s^2$", "$P(s^2)$")

ktbl(outc, caption = "Sample Space")
ktbl(samp, caption = "Sampling Distribution")
```

\pagebreak

## Sampling Distribution of a Proportion

**Example**: What is the sampling distribution of the *proportion* of female platies preferring the yellow-tailed male from a sample of $n$ = 3 observations? 

```{r}
popd <- data.frame(Preference = c("C","Y"), Probability = c(0.3,0.7))

outc <- c("Y, Y, Y","C, Y, Y","Y, C, Y","Y, Y, C","Y, C, C","C, Y, C","C, C, Y","C, C, C")
prob <- c("0.7 $\\times$ 0.7 $\\times$ 0.7 = 0.343", 
  "0.3 $\\times$ 0.7 $\\times$ 0.7 = 0.147", "0.7 $\\times$ 0.3 $\\times$ 0.7 = 0.147", "0.7 $\\times$ 0.7 $\\times$ 0.3 = 0.147",
  "0.7 $\\times$ 0.3 $\\times$ 0.3 = 0.063", "0.3 $\\times$ 0.7 $\\times$ 0.3 = 0.063", "0.3 $\\times$ 0.3 $\\times$ 0.7 = 0.063",
  "0.3 $\\times$ 0.3 $\\times$ 0.3 = 0.027")
prob <- c("0.343","0.147", "0.147", "0.147","0.063", "0.063", "0.063", "0.027")
phat <- c("1", rep("2/3", 3), rep("1/3", 3), 0)
outc <- data.frame(Sample = outc, Probability = prob, Proportion = phat)

names(popd) <- c("$x$","$P(x)$")
names(outc)[3] <- "$\\hat{p}$"

samp <- data.frame(Proportion = c(0,"1/3","2/3",1), Probability = dbinom(0:3, 3, 0.7))
names(samp) <- c("$\\hat{p}$","$P(\\hat{p})$")
```

```{r}
ktbl(popd, caption = "Population Distribution")
ktbl(outc, caption = "Sample Space")
ktbl(samp, caption = "Sampling Distribution")
```
**Note**: We will denote a proportion from a sample as $\hat{p}$. 

\pagebreak

## The Binomial Distribution

Assume that each observation has a probability distribution with two possible values --- a "success" ($S$) and a "failure" ($F$). Assume the probability of a success is $p$ and the probability of a failure is thus $1-p$. Finally assume that the observations are *independent* meaning that the probabilities of a success or failure of any one observation does not depend on the other observations. 
```{r}
popd <- data.frame(Value = c("$S$","$F$"), Probability = c("$p$","$1-p$"))
names(popd) <- c("$x$","$P(x)$")
ktbl(popd)
```

**Example**: Assume the following distribution of one observation for the platy preference.
```{r}
popd <- data.frame(Preference = c("Y","C"), Probability = c(0.7,0.3))
names(popd) <- c("$x$","$P(x)$")
ktbl(popd)
```
Here we are defining $Y$ as a success and $C$ as a failure, so $p$ = 0.7 and $1-p$ = 0.3. 

The *sampling distribution* of the *number of successes* ($s$) in a sample will be a *binomial distribution*. The sampling distribution of $s$ is given by the following equation.[^binom]
$$
  P(s) = \frac{n!}{s!(n-s)!}p^s(1-p)^{n-s}.
$$
Two mathematical details to remember when using this formula:

1. The $!$ symbol is the *factorial operation*. For example,
\begin{align*}
  5! & = 5 \times 4 \times 3 \times 2 \times 1 = 120,  \\
  4! & = 4 \times 3 \times 2 \times 1 = 24, \\
  3! & = 3 \times 2 \times 1 = 6, \\
  2! & = 2 \times 1 = 2, \\
  1! & = 1, \\
  0! & = 1. 
\end{align*}
Note that $0! = 1$, which is perhaps not intuitive.

2. For powers remember that any number raised to the power of 1 is that number (i.e., $p^1 = p$ and $(1-p)^1 = 1-p$), and any number raised to the power of zero is one (i.e., $p^0 = 1$ and $(1-p)^0 = 1$). 

[^binom]: Sometimes we write this as
$$
  P(s) = \binom{n}{s}p^s(1-p)^{n-s},
$$
because $\binom{n}{s} = \frac{n!}{s!(n-s)!}$. The $\binom{n}{s}$ is called the *binomial coefficient*. Also usually this formula is written with $x$ in place of $s$, but I have used $s$ to emphasize that the the formula computes the probability of the number of *successes*. 

\pagebreak

## Sampling Distribution of a Proportion Revisited

**Example**: What is the sampling distribution of the *proportion* of female platies preferring the yellow-tailed male from a sample of $n$ = 3 observations? 

```{r}
popd <- data.frame(Preference = c("C","Y"), Probability = c(0.3,0.7))

outc <- c("Y, Y, Y","C, Y, Y","Y, C, Y","Y, Y, C","Y, C, C","C, Y, C","C, C, Y","C, C, C")
prob <- c("0.7 $\\times$ 0.7 $\\times$ 0.7 = 0.343", 
  "0.3 $\\times$ 0.7 $\\times$ 0.7 = 0.147", "0.7 $\\times$ 0.3 $\\times$ 0.7 = 0.147", "0.7 $\\times$ 0.7 $\\times$ 0.3 = 0.147",
  "0.7 $\\times$ 0.3 $\\times$ 0.3 = 0.063", "0.3 $\\times$ 0.7 $\\times$ 0.3 = 0.063", "0.3 $\\times$ 0.3 $\\times$ 0.7 = 0.063",
  "0.3 $\\times$ 0.3 $\\times$ 0.3 = 0.027")
phat <- c("1", rep("2/3", 3), rep("1/3", 3), 0)
outc <- data.frame(Sample = outc, Probability = prob, c = c(3,2,2,2,1,1,1,0), Proportion = phat)

names(popd) <- c("$x$","$P(x)$")
names(outc)[3:4] <- c("$s$", "$\\hat{p}$")

samp <- data.frame(Proportion = c(0,"1/3","2/3",1), Successes = 0:3, Probability = dbinom(0:3, 3, 0.7))
samp <- samp[,c(2,1,3)]
names(samp) <- c("$\\hat{p}$","$s$","$P(\\hat{p})$")[c(2,1,3)]
```

```{r}
ktbl(popd, caption = "Population Distribution")
ktbl(samp, caption = "Sampling Distribution")
```
**Note**: We will denote a proportion from a sample as $\hat{p}$. 

Here is how we can compute the probabilities in the sampling distribution of $\hat{p}$.
\begin{align*}
P(0) & = \underbrace{\frac{3!}{0!(3-0)!}}_{1}\underbrace{0.7^0(1-0.7)^{3-0}}_{0.027} = 1 \times 0.027 = 0.027 \\
P(1) & = \underbrace{\frac{3!}{1!(3-1)!}}_{3}\underbrace{0.7^1(1-0.7)^{3-1}}_{0.063} = 3 \times 0.063 = 0.189 \\
P(2) & = \underbrace{\frac{3!}{2!(3-2)!}}_{3}\underbrace{0.7^2(1-0.7)^{3-2}}_{0.147} = 3 \times 0.147 = 0.441 \\
P(3) & = \underbrace{\frac{3!}{3!(3-3)!}}_{1}\underbrace{0.7^3(1-0.7)^{3-3}}_{0.343} = 1 \times 0.343 = 0.343 
\end{align*}
Note that the formula computes two parts --- the number of samples that produce $s$ successes out of $n$ observations, and the probability of each sample. These can be seen when we look at the sample space.
```{r}
ktbl(outc, caption = "Sample Space")
```


