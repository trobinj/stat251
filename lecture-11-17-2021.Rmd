---
output:
  html_document:
    theme: readable
---

```{r, echo = FALSE, message = FALSE}
library(lubridate)
date <- "11-17-2021"
weekday <- wday(mdy(date), label = TRUE, abbr = FALSE)
month <- month(mdy(date), label = TRUE)
day <- day(mdy(date))
```

---
title: `r paste(weekday, ", ", month, " ", day, sep = "")`
header-includes:
  - \usepackage{array}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, fig.align = "center", out.width = "100%", fig.width = 9, cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](lecture-", date, ".pdf) copy of this lecture.", sep = ""), "")`

## Genetic Linkage (Bateson, Saunders, and Punnett)

[Genetic linkage](https://en.wikipedia.org/wiki/Genetic_linkage) is the tendency for DNA sequences that are close on a chromosome to be inherited together. An early demonstration of linkage used two traits of sweat peas: flower color (purple or red) and pollen grain shape (long or round). If there is *no linkage* then the probabilities of each combination of traits are as shown in the table below.
```{r}
d <- data.frame(Traits = c("Purple and Long","Purple and Round","Red and Long","Red and Round"), 
  Probability = c("9/16","3/16","3/16","1/16"), observed = c(284,21,21,55), expected = c("","","",""))
ktbl(d, align = "lccc") %>% add_header_above(c(" " = 1, " " = 1, "Count" = 2))
```
How would we conduct a goodness-of-fit test for no linkage? 

\pagebreak

## Tests of Independence

Two categorical variables are said to be **independent** if the distribution of one variable does not depend on the value of the other variable. 

**Example**: Consider the following data where a sample of 1398 children were classified with respect to tonsil size and carrier status of *Streptococcus pyogenes*.[^tonsil]

```{r}
d <- data.frame(Size = c("small","medium","large","Total"),
  yes = c("19","29","24","72"), no = c("497","560","269","1326"), 
  Total = c(516,589,293,1398))
ktbl(d, align = c("lccc")) %>% add_header_above(c(" " = 1, "Carrier" = 2, " " = 1))  %>% column_spec(1, bold = TRUE)
```
These are the *observed* counts. The table below shows the estimated *expected* counts under the assumption that tonsil size and carrier status are *independent*. How are they computed?
```{r}
d <- matrix(c(19,29,24,72,497,560,269,1326,516,589,293,1398), 4, 3, byrow = FALSE)
for (i in 1:3) {
  for (j in 1:2) {
    d[i,j] <- round(d[i,3] * d[4,j] / d[4,3], 2) 
  }
}
d <- cbind(c("small","medium","large","Total"), d)
d <- data.frame(d)
names(d) <- c("Size","yes","no","Total")
ktbl(d, align = c("lccc")) %>% add_header_above(c(" " = 1, "Carrier" = 2, " " = 1))  %>% column_spec(1, bold = TRUE)
```

\pagebreak

## Steps of a Test of Independence

1. State hypotheses in terms of independence of the variables.

2. Check assumptions (all expected counts should be at least five). 

3. Compute the $X^2$ test statistic. Estimate the expected counts using the formula
$$
  \frac{R \times C}{T}
$$
where $R$ and $C$ are the the sum of the observed counts in the corresponding row and column, respectively, and $T$ is the total of all the observed counts.

4. Compute the $p$-value using $(r-1)(c-1)$ as the degrees of freedom, where $r$ and $c$ are the number of rows and columns of observed counts in the table, respectively. 

5. Make a decision/conclusion.

[^tonsil]: Holmes, M. C. & Willaims, R. E. O. (1954). The distribution of carriers of Streptococcus pyogenes among 2413 healthy children. *Journal of Hygiene*, *52*, 165--179. 

\pagebreak

## The Two-Sample Test of Proportions

```{r}
pm <- 21/24
pf <- 14/24
p <- (21+14)/48
z <- (pm-pf)/sqrt(p*(1-p)*(1/24 + 1/24))
```

Recall the study of the influence of applicant's sex on personnel decisions.[^sexrole]
```{r}
d <- data.frame(Applicant = c("male","female","Total"), yes = c(21,14,35), no = c(3,10,13), Total = c(24,24,48))
ktbl(d, align = "lccc") %>% add_header_above(c(" " = 1, "Promotion" = 2, " " = 1))%>% column_spec(1, bold = TRUE)
```
We could investigate the relationship between applicant sex and promotion decision by a test of the hypotheses $H_0\!: p_m-p_f = 0$ versus $H_a\!: p_m-p_f \neq 0$ using the test statistic
$$
  z = \frac{\hat{p}_m-\hat{p}_f}{\sqrt{\hat{p}(1-\hat{p})(1/n_m + 1/n_f)}},
$$
which yields a test statistic of $z$ $\approx$ `r round(z,2)` and a p-value of about `r round(2*pnorm(-z), 2)`. How is this test related to the test of independence using the $X^2$ test statistic? How is the $z$ test statistic limited?

[^sexrole]: Rosen, B. & Jerdee, J. (1974). Influence of sex role stereotypes on personnel decisions. *Journal of Applied Psychology*, *59*, 9--14. 

\pagebreak

## Comparison of Chemotherapy Treatment Strategies

Consider the following data from a randomized experiment comparing two strategies for chemotherapy.[^tumor]
```{r}
d <- data.frame(Strategy = c("sequential","alternating","Total"),
  prog = c(32,53,85),
  no = c(57,51,108),
  partial = c(34,23,57),
  complete = c(28,21,49),
  Total = c(151,148,299))
names(d)[2:5] <- c("progressive disease","no change","partial remission","complete remission")
ktbl(d, align = "lccccc") %>% add_header_above(c(" " = 1, "Tumor Response" = 4, " " = 1))  %>% column_spec(1, bold = TRUE)
```

[^tumor]: Holtbrugge, W. & Schumacher, M. (1991). A comparison of regression models for the analysis of ordered categorical data. *Applied Statistics*, *40*, 249--259.
