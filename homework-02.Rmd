---
title: "Homework Problem Set 2: Cumulative Distributions, Percentiles, & Box Plots"
output: 
  html_document: 
    theme: readable
header-includes:
  - \usepackage{array}
  - \usepackage{booktabs}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, out.width = "100%", fig.align = "center", 
  cache = FALSE, dev = ifelse(knitr::is_html_output(), "png", "pdf"))
```

```{r packages}
library(dplyr)
library(tidyr)
library(ggplot2)
library(kableExtra)
```

```{r utilities}
source("../../utilities.R")
```

`r ifelse(knitr::is_html_output(), paste("You can also download a [PDF](homework-02.pdf) copy of this homework assignment.", sep = ""), "")`

Solutions are given at the end. 

1. The following table shows the distribution of a quantitative variable $x$. 
```{r}
set.seed(101)
x <- rbinom(100, 10, 0.75)
d <- data.frame(x = x) %>% group_by(x) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq))
d %>% rename("$x$" = x, "Frequency" = freq, "Relative Frequency" = relfreq, "Cumulative Relative Frequency" = cumrelfreq) %>% ktbl() %>% column_spec(1:4, width = "2cm")
```
Plot the cumulative distribution and use this plot to find the 25th, 50th, and 75th percentiles. Then use the five number summary draw a box plot that represents the distribution, and find the median, range, and interquartile range.

2. The following table shows the distribution of a quantitative variable $x$. 
```{r}
set.seed(202)
x <- rbinom(500, 10, 0.25)
d <- data.frame(x = x) %>% group_by(x) %>% summarize(freq = n()) %>% 
  mutate(relfreq = freq/sum(freq), cumrelfreq = cumsum(relfreq))
d %>% rename("$x$" = x, "Frequency" = freq, "Relative Frequency" = relfreq, "Cumulative Relative Frequency" = cumrelfreq) %>% ktbl() %>% column_spec(1:4, width = "2cm")
```
Plot the cumulative distribution and use this plot to find the 25th, 50th, and 75th percentiles. Then use the five number summary draw a box plot that represents the distribution, and find the median, range, and interquartile range.

3. Consider the following plot of four samples and their cumulative distributions. Match each cumulative distribution plot with the box plot below that depicts the same distribution. 

```{r, fig.height = 5}
myfive <- function(x) {
  r <- quantile(x, probs = c(0, 0.25, 0.5, 0.75, 1), type = 2)
  names(r) <- c("ymin", "lower", "middle", "upper", "ymax")
  return(r)
}

foo <- function(x, n) {
  y1 <- runif(n/4, x[1], x[2])
  y2 <- runif(n/4, x[2], x[3])
  y3 <- runif(n/4, x[3], x[4])
  y4 <- runif(n/4, x[4], x[5])
  return(c(x,y1,y2,y3,y4))
}

n <- 24

q1 <- c(0, 10, 20, 40, 100)
q2 <- c(0, 60, 80, 90, 100)
q3 <- c(0, 20, 50, 80, 100)
q4 <- c(0, 40, 50, 60, 100)

set.seed(123)

d <- data.frame(x = c(foo(q1,n),foo(q2,n),foo(q3,n),foo(q4,n)), g = rep(letters[1:4], each = n + 5))

p <- ggplot(d, aes(x = x)) + theme_minimal() + facet_wrap(~ g, ncol = 2)
p <- p + stat_ecdf(geom = "step", pad = TRUE, alpha = 0.5)
p <- p + stat_ecdf(geom = "point", pad = FALSE, size = 0.75)
p <- p + scale_x_continuous(breaks = seq(0, 100, by = 10))
p <- p + scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p <- p + labs(y = "Cumulative Relative Frequency")
plot(p)
```

```{r, fig.height = 2}
p <- ggplot(d, aes(x = g, y = x)) + theme_minimal()
p <- p + stat_summary(fun.data = myfive, geom = "boxplot", fatten = 1) + coord_flip()
p <- p + scale_y_continuous(breaks = seq(0, 100, by = 10)) + labs(x = NULL) + noyaxis
plot(p)
```

4. Consider the following cumulative distribution.
```{r, fig.height = 5}
set.seed(103)

d <- data.frame(x = round(rnorm(100, 70, 10)))

p <- ggplot(d, aes(x = x)) + theme_minimal()
p <- p + stat_ecdf(geom = "step", pad = TRUE, alpha = 0.5)
p <- p + stat_ecdf(geom = "point", pad = FALSE, size = 0.75)
p <- p + scale_x_continuous(breaks = seq(0, 100, by = 2))
p <- p + scale_y_continuous(breaks = seq(0, 1, by = 0.05))
p <- p + labs(y = "Cumulative Relative Frequency")
plot(p)
```
Find the 5th and 95th percentiles using the plot.

## Solutions

```{r}
set.seed(101)
x <- rbinom(100, 10, 0.75)
```

1. The 25th, 50th, and 75th percentiles are `r vecprnt(quantile(x, type = 2)[2:4])`, respectively. The box plot is also shown below.
```{r, fig.height = 8}
p <- ggplot(data.frame(x = x), aes(x = x)) + theme_minimal()
p <- p + stat_ecdf(geom = "step", pad = TRUE, alpha = 0.5)
p <- p + stat_ecdf(geom = "point", pad = FALSE, size = 0.75)
p <- p + scale_x_continuous(breaks = seq(0, 10, by = 0.5))
p <- p + scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p <- p + labs(y = "Cumulative Relative Frequency")
pcdf <- p

p <- ggplot(data.frame(x = x), aes(y = x, x = 1)) + theme_classic()
p <- p + stat_summary(fun.data = myfive, geom = "boxplot", fatten = 1) + coord_flip()
p <- p + scale_y_continuous(breaks = seq(0, 10, by = 0.5)) + labs(x = NULL) + noyaxis
pbox <- p

cowplot::plot_grid(pcdf, pbox, nrow = 2, align = "v", rel_heights = c(4,1))
```
Note that the five number summary is `r vecprnt(quantile(x, type = 2))`. So the median is `r quantile(x, type = 2)[3]`, the range is `r sum(quantile(x, type = 2) * c(-1,0,0,0,1))`, and the interquartile range is `r sum(quantile(x, type = 2) * c(0,-1,0,1,0))`.

```{r}
set.seed(202)
x <- rbinom(500, 10, 0.25)
```

2. The 25th, 50th, and 75th percentiles are `r vecprnt(quantile(x, type = 2)[2:4])`, respectively. The box plot is also shown below.
```{r, fig.height = 8}
p <- ggplot(data.frame(x = x), aes(x = x)) + theme_minimal()
p <- p + stat_ecdf(geom = "step", pad = TRUE, alpha = 0.5)
p <- p + stat_ecdf(geom = "point", pad = FALSE, size = 0.75)
p <- p + scale_x_continuous(breaks = seq(0, 10, by = 0.5))
p <- p + scale_y_continuous(breaks = seq(0, 1, by = 0.1))
p <- p + labs(y = "Cumulative Relative Frequency")
pcdf <- p

p <- ggplot(data.frame(x = x), aes(y = x, x = 1)) + theme_classic()
p <- p + stat_summary(fun.data = myfive, geom = "boxplot", fatten = 1) + coord_flip()
p <- p + scale_y_continuous(breaks = seq(0, 10, by = 0.5)) + labs(x = NULL) + noyaxis
pbox <- p

cowplot::plot_grid(pcdf, pbox, nrow = 2, align = "v", rel_heights = c(4,1))
```
Note that the five number summary is `r vecprnt(quantile(x, type = 2))`. So the median is `r quantile(x, type = 2)[3]`, the range is `r sum(quantile(x, type = 2) * c(-1,0,0,0,1))`, and the interquartile range is `r sum(quantile(x, type = 2) * c(0,-1,0,1,0))`.

3. From top to bottom, the box plots correspond to cumulative distributions d, c, b, and a.

```{r}
set.seed(103)
d <- data.frame(x = round(rnorm(100, 70, 10)))
```

4. The 5th and 95th percentiles are `r vecprnt(quantile(d$x, c(0.05, 0.95), type = 2))`, respectively.  
